# 多语言开发指南

## 📖 概述

本指南详细说明了项目中多语言系统的使用规范、命名规则和最佳实践。项目采用基于JSON的语言包和键值对的方式实现多语言支持。

## 🏗️ 多语言架构

### 核心组件
- **语言包**: JSON格式的翻译文件，存储在 `i18n/` 目录下
- **多语言键**: 用于标识翻译内容的唯一键值
- **i18ns包**: 提供多语言消息获取和本地化功能
- **错误系统**: 集成多语言支持的错误处理机制

### 目录结构
```
├── share/errors/i18n/          # 错误相关的多语言包
│   ├── en_US.json             # 英文翻译
│   └── zh_CN.json             # 中文翻译
├── core/service/syssvr/etc/i18n/  # 业务逻辑相关的多语言包
│   ├── en_US.json             # 英文翻译
│   └── zh_CN.json             # 中文翻译
└── share/i18ns/               # 多语言核心库
```

## 🎯 多语言键命名规范

### 1. 错误相关键 (Error Keys)
**格式**: `error.{模块名}.{错误名小驼峰}`

**示例**:
```json
{
  "error.sys.limit": "已到达上限",
  "error.user.usernameAlreadyRegistered": "用户名已经注册",
  "error.device.deviceTimeout": "设备回复超时"
}
```

**模块分类**:
- `error.sys.*` - 系统错误 (100000-199999)
- `error.user.*` - 用户错误 (1000000-1999999)
- `error.device.*` - 设备错误 (2000000-2999999)
- `error.media.*` - 媒体错误 (3000000-3999999)
- `error.file.*` - 文件错误 (1000000-1999999)
- `error.ota.*` - OTA错误 (2100000-2199999)
- `error.ud.*` - 用户数据错误 (4000000-4999999)

### 2. 业务逻辑键 (Business Logic Keys)
**格式**: `{服务名}.{功能}.{包名}.{描述小驼峰}`

**示例**:
```json
{
  "sys.logic.dictmanage.dictNotDefine": "字典未定义",
  "sys.logic.usermanage.userNotFound": "用户不存在",
  "sys.logic.tenantmanage.tenantExists": "租户已存在"
}
```

**层级说明**:
- **服务名**: 服务标识 (如 `sys`, `core`, `things`)
- **功能**: 功能模块 (如 `logic`, `api`, `service`)
- **包名**: 具体包名 (如 `dictmanage`, `usermanage`, `tenantmanage`)
- **描述**: 具体描述的小驼峰形式

## 📝 使用方式

### 1. 错误处理中的多语言

#### 定义错误
```go
// 在错误定义文件中
var (
    Limit = NewCodeError(SysError+27, "error.sys.limit") // 已到达上限
)
```

#### 使用错误
```go
// 基本使用
return errors.Limit

// 添加自定义消息
return errors.Parameter.AddMsg("sys.logic.dictmanage.dictNotDefine") // 字典未定义

// 添加格式化消息
return errors.Parameter.AddMsgf("sys.logic.user.%s", "userNotFound")
```

### 2. 业务逻辑中的多语言

#### 直接使用多语言键
```go
// 在业务逻辑中
if err != nil {
    return nil, errors.Parameter.AddMsg("sys.logic.dictmanage.dictNotDefine")
}
```

#### 获取多语言消息
```go
// 获取默认语言消息
msg := error.GetI18nMsg("")

// 获取指定语言消息
msg := error.GetI18nMsg("zh_CN")
msg := error.GetI18nMsg("en_US")
```

## 📋 语言包管理

### 1. 语言包文件结构

#### 错误语言包 (share/errors/i18n/)
```json
{
  "error.sys.success": "成功",
  "error.sys.otherError": "其他错误",
  "error.user.usernameAlreadyRegistered": "用户名已经注册"
}
```

#### 业务语言包 (core/service/syssvr/etc/i18n/)
```json
{
  "sys.logic.dictmanage.dictNotDefine": "字典未定义",
  "sys.logic.usermanage.userNotFound": "用户不存在"
}
```

### 2. 添加新语言支持

#### 创建新语言包
```bash
# 创建新的语言包文件
touch core/service/syssvr/etc/i18n/fr_FR.json
touch share/errors/i18n/fr_FR.json
```

#### 注册新语言
```go
// 在 i18ns 包中注册新语言
err = i18ns.InitWithEmbedFS(LocaleFS, "i18n")
```

## 🎨 最佳实践

### 1. 命名规范
- **使用小驼峰**: 多语言键使用小驼峰命名法
- **层级清晰**: 按照服务.功能.包.描述的结构组织
- **语义明确**: 键名应该清晰表达含义
- **避免缩写**: 使用完整的单词，避免缩写

### 2. 消息设计
- **用户友好**: 提供清晰、易懂的错误信息
- **具体明确**: 避免模糊的描述
- **可操作**: 提供用户可执行的建议
- **一致性**: 保持相同概念使用相同的术语

### 3. 代码组织
- **集中管理**: 将多语言键集中定义
- **及时更新**: 添加新功能时同步更新语言包
- **版本控制**: 语言包变更需要版本控制
- **测试验证**: 验证多语言消息的正确性

## 🔧 开发流程

### 1. 添加新的多语言消息

#### 步骤1: 确定键名
```go
// 根据功能确定键名
// 业务逻辑: sys.logic.dictmanage.dictNotDefine
// 错误处理: error.user.passwordTooWeak
```

#### 步骤2: 添加语言包
```json
// zh_CN.json
{
  "sys.logic.dictmanage.dictNotDefine": "字典未定义"
}

// en_US.json
{
  "sys.logic.dictmanage.dictNotDefine": "Dictionary not defined"
}
```

#### 步骤3: 在代码中使用
```go
// 使用多语言键
return errors.Parameter.AddMsg("sys.logic.dictmanage.dictNotDefine")
```

### 2. 错误处理流程

#### 定义错误
```go
// 在对应的错误文件中定义
var (
    PasswordTooWeak = NewCodeError(UserError+35, "error.user.passwordTooWeak") // 密码强度不足
)
```

#### 添加翻译
```json
// zh_CN.json
{
  "error.user.passwordTooWeak": "密码强度不足，请使用至少8位包含数字和符号的密码"
}

// en_US.json
{
  "error.user.passwordTooWeak": "Password is too weak, please use at least 8 characters with numbers and symbols"
}
```

## ⚠️ 注意事项

### 1. 命名一致性
- 多语言键必须遵循既定的命名规范
- 相同概念在不同地方使用相同的键名
- 避免重复定义相同含义的键

### 2. 语言包同步
- 添加新键时，所有语言包都需要同步更新
- 删除键时，确保没有代码引用
- 修改键名时，需要更新所有引用

### 3. 性能考虑
- 避免在循环中频繁调用多语言函数
- 合理使用缓存机制
- 考虑语言包的大小和加载时间

### 4. 测试验证
- 验证所有语言包格式正确
- 测试多语言消息的显示效果
- 确保错误处理的多语言支持

## 🆘 常见问题

**Q: 如何确定多语言键应该放在哪个语言包中？**
A: 错误相关的键放在 `share/errors/i18n/` 中，业务逻辑相关的键放在对应服务的 `etc/i18n/` 中。

**Q: 多语言键的层级应该如何设计？**
A: 按照服务.功能.包.描述的结构，确保层级清晰，便于管理和查找。

**Q: 如何处理动态内容的多语言？**
A: 使用格式化字符串，在语言包中定义模板，在代码中传入参数。

**Q: 如何确保多语言消息的一致性？**
A: 建立术语表，相同概念使用相同的翻译，定期审查和更新。

---

**版本**: v1.0  
**更新时间**: 2024年12月  
**维护者**: 开发团队
